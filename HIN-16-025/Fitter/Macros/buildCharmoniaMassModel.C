#ifndef buildCharmoniaMassModel_C
#define buildCharmoniaMassModel_C

#include "Utilities/initClasses.h"
#include "Utilities/RooExtCBShape.h"

void fixMassParPsi2StoJpsi    ( map<string, string>& parIni, const bool& isPbPb );
void setMassDefaultParameters ( map<string, string>& parIni, const bool& isPbPb, const double& numEntries );
bool addSignalMassModel       ( RooWorkspace& ws, const string& object, const MassModel& model, map<string,string> parIni, const bool& isPbPb ); 
bool addBackgroundMassModel   ( RooWorkspace& ws, const string& object, const MassModel& model, map<string,string> parIni, const bool& isPbPb );


bool buildCharmoniaMassModel(RooWorkspace& ws, const struct CharmModel& model, map<string, string>  parIni, 
                             const bool& isPbPb,          // Determine if we are working with PbPb (True) or PP (False)
                             const bool& doConstrFit,     // Do constrained fit
                             const bool& doSimulFit,      // Do simultaneous fit
                             const bool& incBkg,          // Include background model
                             const bool& incJpsi,         // Include Jpsi model
                             const bool& incPsi2S,        // Include Psi(2S) model
                             const double& numEntries,    // Number of entries in the dataset
                             const bool  useRatio = false // Use Ps2S/Jpsi ratio
                             )
{

  // If the initial parameters are empty, set defaul parameter values
  setMassDefaultParameters(parIni, isPbPb, numEntries);

  // Fix all psi2S parameters to jpsi
  if (incJpsi && incPsi2S) {
    fixMassParPsi2StoJpsi(parIni, isPbPb);
  }

  // Let's define the single and double ratio variables
  if (incPsi2S && incJpsi) {
    if (doSimulFit && isPbPb) {

      // create parameters related to the double ratio
      ws.factory( parIni["RFrac2Svs1S_PbPbvsPP"].c_str() );                     // Double Ratio
      ws.factory( parIni[Form("N_Jpsi_%s", (isPbPb?"PbPb":"PP"))].c_str() );    // Number of Jpsi in PbPb

      // Asign NPsi2S(PbPb) = DoubleRatio(PbPb/PP) * SingleRatioPP(Psi2S/Jpsi) * NJpsi(PbPb) 
      ws.factory(Form("RooFormulaVar::%s('@0*@1*@2',{%s,%s,%s})", "N_Psi2S_PbPb", 
		      "RFrac2Svs1S_PbPbvsPP", 
		      "RFrac2Svs1S_PP", 
		      Form("N_Jpsi_%s", (isPbPb?"PbPb":"PP"))
		      )); 
      ws.var("RFrac2Svs1S_PbPbvsPP")->setConstant(kFALSE);

    } else if (useRatio) {

      // create parameters related to the double ratio
      ws.factory( parIni[Form("RFrac2Svs1S_%s", (isPbPb?"PbPb":"PP"))].c_str() );
      ws.factory( parIni[Form("N_Jpsi_%s", (isPbPb?"PbPb":"PP"))].c_str() );

      // Asign N(Psi2S) = SingleRatio(Psi2S/Jpsi) * N(Jpsi)
      ws.factory(Form("RooFormulaVar::%s('@0*@1',{%s,%s})", Form("N_Psi2S_%s", (isPbPb?"PbPb":"PP")), 
		      Form("RFrac2Svs1S_%s", (isPbPb?"PbPb":"PP")),
		      Form("N_Jpsi_%s", (isPbPb?"PbPb":"PP")) 
		      )); 
      ws.var(Form("RFrac2Svs1S_%s", (isPbPb?"PbPb":"PP")))->setConstant(kFALSE);

    } else {

      // create parameters related to the double ratio
      ws.factory( parIni[Form("N_Psi2S_%s", (isPbPb?"PbPb":"PP"))].c_str() );
      ws.factory( parIni[Form("N_Jpsi_%s", (isPbPb?"PbPb":"PP"))].c_str() );

    }
    
    // As we have already declared the Number of Psi2S and Jpsi before, just use their names in their PDFs
    parIni[Form("N_Jpsi_%s", (isPbPb?"PbPb":"PP"))] = Form("N_Jpsi_%s", (isPbPb?"PbPb":"PP"));
    parIni[Form("N_Psi2S_%s", (isPbPb?"PbPb":"PP"))] = Form("N_Psi2S_%s", (isPbPb?"PbPb":"PP")); 
  }

  // C r e a t e   m o d e l  

  if (incJpsi) {
    if(!addSignalMassModel(ws, "Jpsi", model.Jpsi.Mass, parIni, isPbPb)) { cout << "[ERROR] Adding Jpsi Mass Model failed" << endl; return false; }
  }
  if (incPsi2S) { 
    if (!addSignalMassModel(ws, "Psi2S", model.Psi2S.Mass, parIni, isPbPb)) { cout << "[ERROR] Adding Psi(2S) Mass Model failed" << endl; return false; }  
  }
  if (incBkg) {
    if(!addBackgroundMassModel(ws, "Bkg", model.Bkg.Mass, parIni, isPbPb)) { cout << "[ERROR] Adding Background Mass Model failed" << endl; return false; }
  }

  // Constraint PDFs
  if (doConstrFit) //FIXME: hardcoded values should be moved to input files
  {
    if (isPbPb)
    {
      ws.factory(Form("Gaussian::sigmaAlphaConstr(%s,RooConstVar(%f),RooConstVar(%f))",Form("alpha_Jpsi_%s", isPbPb?"PbPb":"PP"), ws.var(Form("alpha_Jpsi_%s", isPbPb?"PbPb":"PP"))->getValV(), 0.21*ws.var(Form("alpha_Jpsi_%s", isPbPb?"PbPb":"PP"))->getValV()));
      ws.factory(Form("Gaussian::sigmaNConstr(%s,RooConstVar(%f),RooConstVar(%f))",Form("n_Jpsi_%s", isPbPb?"PbPb":"PP"), ws.var(Form("n_Jpsi_%s", isPbPb?"PbPb":"PP"))->getValV(), 0.54*ws.var(Form("n_Jpsi_%s", isPbPb?"PbPb":"PP"))->getValV()));
      ws.factory(Form("Gaussian::sigmaRSigmaConstr(%s,RooConstVar(%f),RooConstVar(%f))",Form("rSigma21_Jpsi_%s", isPbPb?"PbPb":"PP"), ws.var(Form("rSigma21_Jpsi_%s", isPbPb?"PbPb":"PP"))->getValV(), 0.3*ws.var(Form("rSigma21_Jpsi_%s", isPbPb?"PbPb":"PP"))->getValV()));
    }
    else
    {
      ws.factory(Form("Gaussian::sigmaAlphaConstr(%s,RooConstVar(%f),RooConstVar(%f))",Form("alpha_Jpsi_%s", isPbPb?"PbPb":"PP"), ws.var(Form("alpha_Jpsi_%s", isPbPb?"PbPb":"PP"))->getValV(), 0.16*ws.var(Form("alpha_Jpsi_%s", isPbPb?"PbPb":"PP"))->getValV()));
      ws.factory(Form("Gaussian::sigmaNConstr(%s,RooConstVar(%f),RooConstVar(%f))",Form("n_Jpsi_%s", isPbPb?"PbPb":"PP"), ws.var(Form("n_Jpsi_%s", isPbPb?"PbPb":"PP"))->getValV(), 0.21*ws.var(Form("n_Jpsi_%s", isPbPb?"PbPb":"PP"))->getValV()));
    }
  }
  
  // Total PDF
  const string pdfType = "pdfMASS";
  const string pdfName = Form("%s_Tot_%s", pdfType.c_str(), (isPbPb?"PbPb":"PP"));

  RooArgList pdfList;
  if (incJpsi) { pdfList.add( *ws.pdf(Form("%sTot_Jpsi_%s", pdfType.c_str(), (isPbPb?"PbPb":"PP"))) );  }
  if (incPsi2S){ pdfList.add( *ws.pdf(Form("%sTot_Psi2S_%s", pdfType.c_str(), (isPbPb?"PbPb":"PP"))) ); }
  if (incBkg)  { pdfList.add( *ws.pdf(Form("%sTot_Bkg_%s", pdfType.c_str(), (isPbPb?"PbPb":"PP"))) );   }
  if (!incJpsi && !incPsi2S && !incBkg) { cout << "[ERROR] User did not include any model, please fix your input settings!" << endl; return false; }
  auto themodel = std::unique_ptr<RooAddPdf>(new RooAddPdf(pdfName.c_str(), pdfName.c_str(), pdfList));
  ws.import(*themodel);
  ws.pdf(pdfName.c_str())->setNormRange("MassWindow");

  setFixedVarsToContantVars(ws);

  // save the initial values of the model we've just created
  auto params = std::unique_ptr<RooArgSet>(themodel->getParameters(RooArgSet(*ws.var("invMass"))));
  ws.saveSnapshot((pdfName+"_parIni").c_str(),*params,kTRUE);
  
  return true;
};

bool addBackgroundMassModel(RooWorkspace& ws, const string& object, const MassModel& model, map<string,string> parIni, const bool& isPbPb)
{
  cout << Form("[INFO] Implementing %s Background Mass Model", object.c_str()) << endl;

  // Import the Yield parameter
  if (!ws.var(Form("N_%s_%s", object.c_str(), (isPbPb?"PbPb":"PP")))) { ws.factory(parIni[Form("N_%s_%s", object.c_str(), (isPbPb?"PbPb":"PP"))].c_str()); }

  switch(model) 
    {  
    case (MassModel::Uniform): 

      // create the PDF           
      ws.factory(Form("Uniform::%s(%s)", Form("pdfMASS_%s_%s", object.c_str(), (isPbPb?"PbPb":"PP")), "invMass"));

      ws.factory(Form("RooExtendPdf::%s(%s,%s)", Form("pdfMASSTot_%s_%s", object.c_str(), (isPbPb?"PbPb":"PP")),
                      Form("pdfMASS_%s_%s", object.c_str(), (isPbPb?"PbPb":"PP")),
                      Form("N_%s_%s", object.c_str(), (isPbPb?"PbPb":"PP"))
                      ));

      cout << Form("[INFO] %s Background Uniform PDF in %s included", object.c_str(), (isPbPb?"PbPb":"PP")) << endl; break;
 
    case (MassModel::Chebychev1): 

      // check that all input parameters are defined 
      if (!( 
            parIni.count(Form("lambda1_%s_%s", object.c_str(), (isPbPb?"PbPb":"PP"))) 
             )) { 
	cout << Form("[ERROR] Initial parameters where not found for %s Background First Order Chebychev in %s", object.c_str(), (isPbPb?"PbPb":"PP")) << endl; return false;
      } 

      // create the variables for this model
      ws.factory( parIni[Form("lambda1_%s_%s", object.c_str(), (isPbPb?"PbPb":"PP"))].c_str() );

      // create the PDF           
      ws.factory(Form("Chebychev::%s(%s, {%s})", Form("pdfMASS_%s_%s", object.c_str(), (isPbPb?"PbPb":"PP")), "invMass", 
		      Form("lambda1_%s_%s", object.c_str(), (isPbPb?"PbPb":"PP"))
		      ));

      ws.factory(Form("RooExtendPdf::%s(%s,%s)", Form("pdfMASSTot_%s_%s", object.c_str(), (isPbPb?"PbPb":"PP")),
                      Form("pdfMASS_%s_%s", object.c_str(), (isPbPb?"PbPb":"PP")),
                      Form("N_%s_%s", object.c_str(), (isPbPb?"PbPb":"PP"))
                      ));

      cout << Form("[INFO] %s Background 1st Order Chebychev PDF in %s included", object.c_str(), (isPbPb?"PbPb":"PP")) << endl; break;
 
    case (MassModel::Chebychev2): 

      // check that all input parameters are defined 
      if (!( 
            parIni.count(Form("lambda1_%s_%s", object.c_str(), (isPbPb?"PbPb":"PP"))) && 
            parIni.count(Form("lambda2_%s_%s", object.c_str(), (isPbPb?"PbPb":"PP"))) 
             )) { 
	cout << Form("[ERROR] Initial parameters where not found for %s Background Second Order Chebychev in %s", object.c_str(), (isPbPb?"PbPb":"PP")) << endl; return false;
      } 

      // create the variables for this model
      ws.factory( parIni[Form("lambda1_%s_%s", object.c_str(), (isPbPb?"PbPb":"PP"))].c_str() );
      ws.factory( parIni[Form("lambda2_%s_%s", object.c_str(), (isPbPb?"PbPb":"PP"))].c_str() );

      // create the PDF           
      ws.factory(Form("Chebychev::%s(%s, {%s, %s})", Form("pdfMASS_%s_%s", object.c_str(), (isPbPb?"PbPb":"PP")), "invMass", 
		      Form("lambda1_%s_%s", object.c_str(), (isPbPb?"PbPb":"PP")), 
		      Form("lambda2_%s_%s", object.c_str(), (isPbPb?"PbPb":"PP"))
		      ));

      ws.factory(Form("RooExtendPdf::%s(%s,%s)", Form("pdfMASSTot_%s_%s", object.c_str(), (isPbPb?"PbPb":"PP")),
                      Form("pdfMASS_%s_%s", object.c_str(), (isPbPb?"PbPb":"PP")),
                      Form("N_%s_%s", object.c_str(), (isPbPb?"PbPb":"PP"))
                      ));

      cout << Form("[INFO] %s Background 2nd Order Chebychev PDF in %s included", object.c_str(), (isPbPb?"PbPb":"PP")) << endl; break; 

    case (MassModel::Chebychev3): 

      // check that all input parameters are defined 
      if (!( 
            parIni.count(Form("lambda1_%s_%s", object.c_str(), (isPbPb?"PbPb":"PP"))) && 
            parIni.count(Form("lambda2_%s_%s", object.c_str(), (isPbPb?"PbPb":"PP"))) && 
            parIni.count(Form("lambda3_%s_%s", object.c_str(), (isPbPb?"PbPb":"PP"))) 
             )) { 
	cout << Form("[ERROR] Initial parameters where not found for %s Background Third Order Chebychev in %s", object.c_str(), (isPbPb?"PbPb":"PP")) << endl; return false;
      }

      // create the variables for this model 
      ws.factory( parIni[Form("lambda1_%s_%s", object.c_str(), (isPbPb?"PbPb":"PP"))].c_str() );
      ws.factory( parIni[Form("lambda2_%s_%s", object.c_str(), (isPbPb?"PbPb":"PP"))].c_str() );
      ws.factory( parIni[Form("lambda3_%s_%s", object.c_str(), (isPbPb?"PbPb":"PP"))].c_str() );

      // create the PDF                 
      ws.factory(Form("Chebychev::%s(%s, {%s, %s, %s})", Form("pdfMASS_%s_%s", object.c_str(), (isPbPb?"PbPb":"PP")), "invMass", 
		      Form("lambda1_%s_%s", object.c_str(), (isPbPb?"PbPb":"PP")), 
		      Form("lambda2_%s_%s", object.c_str(), (isPbPb?"PbPb":"PP")), 
		      Form("lambda3_%s_%s", object.c_str(), (isPbPb?"PbPb":"PP"))
		      ));

      ws.factory(Form("RooExtendPdf::%s(%s,%s)", Form("pdfMASSTot_%s_%s", object.c_str(), (isPbPb?"PbPb":"PP")),
                      Form("pdfMASS_%s_%s", object.c_str(), (isPbPb?"PbPb":"PP")),
                      Form("N_%s_%s", object.c_str(), (isPbPb?"PbPb":"PP"))
                      ));

      cout << Form("[INFO] %s Background 3rd Order Chebychev PDF in %s included", object.c_str(), (isPbPb?"PbPb":"PP")) << endl; break; 

    case (MassModel::Chebychev4): 

      // check that all input parameters are defined 
      if (!( 
            parIni.count(Form("lambda1_%s_%s", object.c_str(), (isPbPb?"PbPb":"PP"))) && 
            parIni.count(Form("lambda2_%s_%s", object.c_str(), (isPbPb?"PbPb":"PP"))) && 
            parIni.count(Form("lambda3_%s_%s", object.c_str(), (isPbPb?"PbPb":"PP"))) && 
            parIni.count(Form("lambda4_%s_%s", object.c_str(), (isPbPb?"PbPb":"PP"))) 
             )) { 
	cout << Form("[ERROR] Initial parameters where not found for %s Background Fourth Order Chebychev in %s", object.c_str(), (isPbPb?"PbPb":"PP")) << endl; return false;
      }

      // create the variables for this model        
      ws.factory( parIni[Form("lambda1_%s_%s", object.c_str(), (isPbPb?"PbPb":"PP"))].c_str() );
      ws.factory( parIni[Form("lambda2_%s_%s", object.c_str(), (isPbPb?"PbPb":"PP"))].c_str() );
      ws.factory( parIni[Form("lambda3_%s_%s", object.c_str(), (isPbPb?"PbPb":"PP"))].c_str() );
      ws.factory( parIni[Form("lambda4_%s_%s", object.c_str(), (isPbPb?"PbPb":"PP"))].c_str() );

      // create the PDF                 
      ws.factory(Form("Chebychev::%s(%s, {%s, %s, %s, %s})", Form("pdfMASS_%s_%s", object.c_str(), (isPbPb?"PbPb":"PP")), "invMass", 
		      Form("lambda1_%s_%s", object.c_str(), (isPbPb?"PbPb":"PP")), 
		      Form("lambda2_%s_%s", object.c_str(), (isPbPb?"PbPb":"PP")), 
		      Form("lambda3_%s_%s", object.c_str(), (isPbPb?"PbPb":"PP")), 
		      Form("lambda4_%s_%s", object.c_str(), (isPbPb?"PbPb":"PP"))
		      ));

      ws.factory(Form("RooExtendPdf::%s(%s,%s)", Form("pdfMASSTot_%s_%s", object.c_str(), (isPbPb?"PbPb":"PP")),
                      Form("pdfMASS_%s_%s", object.c_str(), (isPbPb?"PbPb":"PP")),
                      Form("N_%s_%s", object.c_str(), (isPbPb?"PbPb":"PP"))
                      ));

      cout << Form("[INFO] %s Background 4th Order Chebychev PDF in %s included", object.c_str(), (isPbPb?"PbPb":"PP")) << endl; break; 

    case (MassModel::Chebychev5): 

      // check that all input parameters are defined 
      if (!( 
            parIni.count(Form("lambda1_%s_%s", object.c_str(), (isPbPb?"PbPb":"PP"))) && 
            parIni.count(Form("lambda2_%s_%s", object.c_str(), (isPbPb?"PbPb":"PP"))) && 
            parIni.count(Form("lambda3_%s_%s", object.c_str(), (isPbPb?"PbPb":"PP"))) && 
            parIni.count(Form("lambda4_%s_%s", object.c_str(), (isPbPb?"PbPb":"PP"))) && 
            parIni.count(Form("lambda5_%s_%s", object.c_str(), (isPbPb?"PbPb":"PP"))) 
             )) { 
	cout << Form("[ERROR] Initial parameters where not found for %s Background Fifth Order Chebychev in %s", object.c_str(), (isPbPb?"PbPb":"PP")) << endl; return false;
      }

      // create the variables for this model        
      ws.factory( parIni[Form("lambda1_%s_%s", object.c_str(), (isPbPb?"PbPb":"PP"))].c_str() );
      ws.factory( parIni[Form("lambda2_%s_%s", object.c_str(), (isPbPb?"PbPb":"PP"))].c_str() );
      ws.factory( parIni[Form("lambda3_%s_%s", object.c_str(), (isPbPb?"PbPb":"PP"))].c_str() );
      ws.factory( parIni[Form("lambda4_%s_%s", object.c_str(), (isPbPb?"PbPb":"PP"))].c_str() );
      ws.factory( parIni[Form("lambda5_%s_%s", object.c_str(), (isPbPb?"PbPb":"PP"))].c_str() );

      // create the PDF                 
      ws.factory(Form("Chebychev::%s(%s, {%s, %s, %s, %s, %s})", Form("pdfMASS_%s_%s", object.c_str(), (isPbPb?"PbPb":"PP")), "invMass", 
		      Form("lambda1_%s_%s", object.c_str(), (isPbPb?"PbPb":"PP")), 
		      Form("lambda2_%s_%s", object.c_str(), (isPbPb?"PbPb":"PP")), 
		      Form("lambda3_%s_%s", object.c_str(), (isPbPb?"PbPb":"PP")), 
		      Form("lambda4_%s_%s", object.c_str(), (isPbPb?"PbPb":"PP")), 
		      Form("lambda5_%s_%s", object.c_str(), (isPbPb?"PbPb":"PP"))
		      ));

      ws.factory(Form("RooExtendPdf::%s(%s,%s)", Form("pdfMASSTot_%s_%s", object.c_str(), (isPbPb?"PbPb":"PP")),
                      Form("pdfMASS_%s_%s", object.c_str(), (isPbPb?"PbPb":"PP")),
                      Form("N_%s_%s", object.c_str(), (isPbPb?"PbPb":"PP"))
                      ));

      cout << Form("[INFO] %s Background 5th Order Chebychev PDF in %s included", object.c_str(), (isPbPb?"PbPb":"PP")) << endl; break; 

    case (MassModel::Chebychev6): 

      // check that all input parameters are defined 
      if (!( 
            parIni.count(Form("lambda1_%s_%s", object.c_str(), (isPbPb?"PbPb":"PP"))) && 
            parIni.count(Form("lambda2_%s_%s", object.c_str(), (isPbPb?"PbPb":"PP"))) && 
            parIni.count(Form("lambda3_%s_%s", object.c_str(), (isPbPb?"PbPb":"PP"))) && 
            parIni.count(Form("lambda4_%s_%s", object.c_str(), (isPbPb?"PbPb":"PP"))) && 
            parIni.count(Form("lambda5_%s_%s", object.c_str(), (isPbPb?"PbPb":"PP"))) && 
            parIni.count(Form("lambda6_%s_%s", object.c_str(), (isPbPb?"PbPb":"PP"))) 
             )) { 
	cout << Form("[ERROR] Initial parameters where not found for %s Background Sixth Order Chebychev in %s", object.c_str(), (isPbPb?"PbPb":"PP")) << endl; return false;
      }

      // create the variables for this model        
      ws.factory( parIni[Form("lambda1_%s_%s", object.c_str(), (isPbPb?"PbPb":"PP"))].c_str() );
      ws.factory( parIni[Form("lambda2_%s_%s", object.c_str(), (isPbPb?"PbPb":"PP"))].c_str() );
      ws.factory( parIni[Form("lambda3_%s_%s", object.c_str(), (isPbPb?"PbPb":"PP"))].c_str() );
      ws.factory( parIni[Form("lambda4_%s_%s", object.c_str(), (isPbPb?"PbPb":"PP"))].c_str() );
      ws.factory( parIni[Form("lambda5_%s_%s", object.c_str(), (isPbPb?"PbPb":"PP"))].c_str() );
      ws.factory( parIni[Form("lambda6_%s_%s", object.c_str(), (isPbPb?"PbPb":"PP"))].c_str() );

      // create the PDF                 
      ws.factory(Form("Chebychev::%s(%s, {%s, %s, %s, %s, %s, %s})", Form("pdfMASS_%s_%s", object.c_str(), (isPbPb?"PbPb":"PP")), "invMass", 
		      Form("lambda1_%s_%s", object.c_str(), (isPbPb?"PbPb":"PP")), 
		      Form("lambda2_%s_%s", object.c_str(), (isPbPb?"PbPb":"PP")), 
		      Form("lambda3_%s_%s", object.c_str(), (isPbPb?"PbPb":"PP")), 
		      Form("lambda4_%s_%s", object.c_str(), (isPbPb?"PbPb":"PP")), 
		      Form("lambda5_%s_%s", object.c_str(), (isPbPb?"PbPb":"PP")), 
		      Form("lambda6_%s_%s", object.c_str(), (isPbPb?"PbPb":"PP"))
		      ));

      ws.factory(Form("RooExtendPdf::%s(%s,%s)", Form("pdfMASSTot_%s_%s", object.c_str(), (isPbPb?"PbPb":"PP")),
                      Form("pdfMASS_%s_%s", object.c_str(), (isPbPb?"PbPb":"PP")),
                      Form("N_%s_%s", object.c_str(), (isPbPb?"PbPb":"PP"))
                      ));

      cout << Form("[INFO] %s Background 6th Order Chebychev PDF in %s included", object.c_str(), (isPbPb?"PbPb":"PP")) << endl; break; 

    case (MassModel::ExpChebychev1): 

      // check that all input parameters are defined 
      if (!( 
            parIni.count(Form("lambda1_%s_%s", object.c_str(), (isPbPb?"PbPb":"PP"))) 
             )) { 
	cout << Form("[ERROR] Initial parameters where not found for %s Background First Order Exponential Chebychev in %s", object.c_str(), (isPbPb?"PbPb":"PP")) << endl; return false;
      }

      // create the variables for this model        
      ws.factory( parIni["invMassNorm"].c_str() );
      ws.factory( parIni[Form("lambda1_%s_%s", object.c_str(), (isPbPb?"PbPb":"PP"))].c_str() );

      // create the PDF                 
      ws.factory(Form("RooFormulaVar::%s('@1*(@0) + 1.0', {%s, %s})", 
                      Form("pdfMASSPol_%s_%s", object.c_str(), (isPbPb?"PbPb":"PP")), "invMassNorm", 
		      Form("lambda1_%s_%s", object.c_str(), (isPbPb?"PbPb":"PP"))
		      ));               

      ws.factory(Form("Exponential::%s(%s, One[1.0])", Form("pdfMASS_%s_%s", object.c_str(), (isPbPb?"PbPb":"PP")),
                      Form("pdfMASSPol_%s_%s", object.c_str(), (isPbPb?"PbPb":"PP"))
                      ));

      ws.factory(Form("RooExtendPdf::%s(%s,%s)", Form("pdfMASSTot_%s_%s", object.c_str(), (isPbPb?"PbPb":"PP")),
                      Form("pdfMASS_%s_%s", object.c_str(), (isPbPb?"PbPb":"PP")),
                      Form("N_%s_%s", object.c_str(), (isPbPb?"PbPb":"PP"))
                      ));

      cout << Form("[INFO] %s Background 1st Order Exponential Chebychev PDF in %s included", object.c_str(), (isPbPb?"PbPb":"PP")) << endl; break; 
   
    case (MassModel::ExpChebychev2): 

      // check that all input parameters are defined 
      if (!( 
            parIni.count(Form("lambda1_%s_%s", object.c_str(), (isPbPb?"PbPb":"PP"))),
            parIni.count(Form("lambda2_%s_%s", object.c_str(), (isPbPb?"PbPb":"PP")))  
             )) { 
	cout << Form("[ERROR] Initial parameters where not found for %s Background Second Order Exponential Chebychev in %s", object.c_str(), (isPbPb?"PbPb":"PP")) << endl; return false;
      }

      // create the variables for this model    
      ws.factory( parIni["invMassNorm"].c_str() );    
      ws.factory( parIni[Form("lambda1_%s_%s", object.c_str(), (isPbPb?"PbPb":"PP"))].c_str() );
      ws.factory( parIni[Form("lambda2_%s_%s", object.c_str(), (isPbPb?"PbPb":"PP"))].c_str() );

      // create the PDF            
      ws.factory(Form("RooFormulaVar::%s('@2*(2.0*@0*@0 - 1.0) + @1*(@0) + 1.0', {%s, %s, %s})", 
                      Form("pdfMASSPol_%s_%s", object.c_str(), (isPbPb?"PbPb":"PP")), "invMassNorm",
		      Form("lambda1_%s_%s", object.c_str(), (isPbPb?"PbPb":"PP")), 
		      Form("lambda2_%s_%s", object.c_str(), (isPbPb?"PbPb":"PP"))
		      ));             

      ws.factory(Form("Exponential::%s(%s, One[1.0])", Form("pdfMASS_%s_%s", object.c_str(), (isPbPb?"PbPb":"PP")),
                      Form("pdfMASSPol_%s_%s", object.c_str(), (isPbPb?"PbPb":"PP"))
                      ));

      ws.factory(Form("RooExtendPdf::%s(%s,%s)", Form("pdfMASSTot_%s_%s", object.c_str(), (isPbPb?"PbPb":"PP")),
                      Form("pdfMASS_%s_%s", object.c_str(), (isPbPb?"PbPb":"PP")),
                      Form("N_%s_%s", object.c_str(), (isPbPb?"PbPb":"PP"))
                      ));

      cout << Form("[INFO] %s Background 2nd Order Exponential Chebychev PDF in %s included", object.c_str(), (isPbPb?"PbPb":"PP")) << endl; break; 
   
    case (MassModel::ExpChebychev3): 

      // check that all input parameters are defined 
      if (!( 
            parIni.count(Form("lambda1_%s_%s", object.c_str(), (isPbPb?"PbPb":"PP"))),
            parIni.count(Form("lambda2_%s_%s", object.c_str(), (isPbPb?"PbPb":"PP"))),
            parIni.count(Form("lambda3_%s_%s", object.c_str(), (isPbPb?"PbPb":"PP")))  
             )) { 
	cout << Form("[ERROR] Initial parameters where not found for %s Background Third Order Exponential Chebychev in %s", object.c_str(), (isPbPb?"PbPb":"PP")) << endl; return false;
      }

      // create the variables for this model  
      ws.factory( parIni["invMassNorm"].c_str() );      
      ws.factory( parIni[Form("lambda1_%s_%s", object.c_str(), (isPbPb?"PbPb":"PP"))].c_str() );
      ws.factory( parIni[Form("lambda2_%s_%s", object.c_str(), (isPbPb?"PbPb":"PP"))].c_str() );
      ws.factory( parIni[Form("lambda3_%s_%s", object.c_str(), (isPbPb?"PbPb":"PP"))].c_str() );

      // create the PDF
      ws.factory(Form("RooFormulaVar::%s('@3*(4.0*@0*@0*@0 - 3.0*@0) + @2*(2.0*@0*@0 - 1.0) + @1*(@0) + 1.0', {%s, %s, %s, %s})", 
                      Form("pdfMASSPol_%s_%s", object.c_str(), (isPbPb?"PbPb":"PP")), "invMassNorm",
		      Form("lambda1_%s_%s", object.c_str(), (isPbPb?"PbPb":"PP")), 
		      Form("lambda2_%s_%s", object.c_str(), (isPbPb?"PbPb":"PP")), 
		      Form("lambda3_%s_%s", object.c_str(), (isPbPb?"PbPb":"PP"))
		      ));        

      ws.factory(Form("Exponential::%s(%s, One[1.0])", Form("pdfMASS_%s_%s", object.c_str(), (isPbPb?"PbPb":"PP")),
                      Form("pdfMASSPol_%s_%s", object.c_str(), (isPbPb?"PbPb":"PP"))
                      ));

      ws.factory(Form("RooExtendPdf::%s(%s,%s)", Form("pdfMASSTot_%s_%s", object.c_str(), (isPbPb?"PbPb":"PP")),
                      Form("pdfMASS_%s_%s", object.c_str(), (isPbPb?"PbPb":"PP")),
                      Form("N_%s_%s", object.c_str(), (isPbPb?"PbPb":"PP"))
                      ));

      cout << Form("[INFO] %s Background 3rd Order Exponential Chebychev PDF in %s included", object.c_str(), (isPbPb?"PbPb":"PP")) << endl; break; 
   
    case (MassModel::ExpChebychev4): 

      // check that all input parameters are defined 
      if (!( 
            parIni.count(Form("lambda1_%s_%s", object.c_str(), (isPbPb?"PbPb":"PP"))),
            parIni.count(Form("lambda2_%s_%s", object.c_str(), (isPbPb?"PbPb":"PP"))),
            parIni.count(Form("lambda3_%s_%s", object.c_str(), (isPbPb?"PbPb":"PP"))),
            parIni.count(Form("lambda4_%s_%s", object.c_str(), (isPbPb?"PbPb":"PP")))    
             )) { 
	cout << Form("[ERROR] Initial parameters where not found for %s Background Fourth Order Exponential Chebychev in %s", object.c_str(), (isPbPb?"PbPb":"PP")) << endl; return false;
      }

      // create the variables for this model   
      ws.factory( parIni["invMassNorm"].c_str() );     
      ws.factory( parIni[Form("lambda1_%s_%s", object.c_str(), (isPbPb?"PbPb":"PP"))].c_str() );
      ws.factory( parIni[Form("lambda2_%s_%s", object.c_str(), (isPbPb?"PbPb":"PP"))].c_str() );
      ws.factory( parIni[Form("lambda3_%s_%s", object.c_str(), (isPbPb?"PbPb":"PP"))].c_str() );
      ws.factory( parIni[Form("lambda4_%s_%s", object.c_str(), (isPbPb?"PbPb":"PP"))].c_str() );

      // create the PDF                 
      ws.factory(Form("RooFormulaVar::%s('@4*(8.0*@0*@0*@0*@0 - 8.0*@0*@0 + 1.0) + @3*(4.0*@0*@0*@0 - 3.0*@0) + @2*(2.0*@0*@0 - 1.0) + @1*(@0) + 1.0', {%s, %s, %s, %s, %s})", 
                      Form("pdfMASSPol_%s_%s", object.c_str(), (isPbPb?"PbPb":"PP")), "invMassNorm",
		      Form("lambda1_%s_%s", object.c_str(), (isPbPb?"PbPb":"PP")), 
		      Form("lambda2_%s_%s", object.c_str(), (isPbPb?"PbPb":"PP")), 
		      Form("lambda3_%s_%s", object.c_str(), (isPbPb?"PbPb":"PP")), 
		      Form("lambda4_%s_%s", object.c_str(), (isPbPb?"PbPb":"PP"))
		      ));

      ws.factory(Form("Exponential::%s(%s, One[1.0])", Form("pdfMASS_%s_%s", object.c_str(), (isPbPb?"PbPb":"PP")),
                      Form("pdfMASSPol_%s_%s", object.c_str(), (isPbPb?"PbPb":"PP"))
                      ));

      ws.factory(Form("RooExtendPdf::%s(%s,%s)", Form("pdfMASSTot_%s_%s", object.c_str(), (isPbPb?"PbPb":"PP")),
                      Form("pdfMASS_%s_%s", object.c_str(), (isPbPb?"PbPb":"PP")),
                      Form("N_%s_%s", object.c_str(), (isPbPb?"PbPb":"PP"))
                      ));

      cout << Form("[INFO] %s Background 4th Order Exponential Chebychev PDF in %s included", object.c_str(), (isPbPb?"PbPb":"PP")) << endl; break; 
   
    case (MassModel::ExpChebychev5): 

      // check that all input parameters are defined 
      if (!( 
            parIni.count(Form("lambda1_%s_%s", object.c_str(), (isPbPb?"PbPb":"PP"))),
            parIni.count(Form("lambda2_%s_%s", object.c_str(), (isPbPb?"PbPb":"PP"))),
            parIni.count(Form("lambda3_%s_%s", object.c_str(), (isPbPb?"PbPb":"PP"))),
            parIni.count(Form("lambda4_%s_%s", object.c_str(), (isPbPb?"PbPb":"PP"))),
            parIni.count(Form("lambda5_%s_%s", object.c_str(), (isPbPb?"PbPb":"PP")))    
             )) { 
	cout << Form("[ERROR] Initial parameters where not found for %s Background Fifth Order Exponential Chebychev in %s", object.c_str(), (isPbPb?"PbPb":"PP")) << endl; return false;
      }

      // create the variables for this model     
      ws.factory( parIni["invMassNorm"].c_str() );   
      ws.factory( parIni[Form("lambda1_%s_%s", object.c_str(), (isPbPb?"PbPb":"PP"))].c_str() );
      ws.factory( parIni[Form("lambda2_%s_%s", object.c_str(), (isPbPb?"PbPb":"PP"))].c_str() );
      ws.factory( parIni[Form("lambda3_%s_%s", object.c_str(), (isPbPb?"PbPb":"PP"))].c_str() );
      ws.factory( parIni[Form("lambda4_%s_%s", object.c_str(), (isPbPb?"PbPb":"PP"))].c_str() );
      ws.factory( parIni[Form("lambda5_%s_%s", object.c_str(), (isPbPb?"PbPb":"PP"))].c_str() );

      // create the PDF       
      ws.factory(Form("RooFormulaVar::%s('@5*(16.0*@0*@0*@0*@0*@0 - 20.0*@0*@0*@0 + 5.0*@0) + @4*(8.0*@0*@0*@0*@0 - 8.0*@0*@0 + 1.0) + @3*(4.0*@0*@0*@0 - 3.0*@0) + @2*(2.0*@0*@0 - 1.0) + @1*(@0) + 1.0', {%s, %s, %s, %s, %s, %s})", 
                      Form("pdfMASSPol_%s_%s", object.c_str(), (isPbPb?"PbPb":"PP")), "invMassNorm", 
		      Form("lambda1_%s_%s", object.c_str(), (isPbPb?"PbPb":"PP")), 
		      Form("lambda2_%s_%s", object.c_str(), (isPbPb?"PbPb":"PP")), 
		      Form("lambda3_%s_%s", object.c_str(), (isPbPb?"PbPb":"PP")), 
		      Form("lambda4_%s_%s", object.c_str(), (isPbPb?"PbPb":"PP")), 
		      Form("lambda5_%s_%s", object.c_str(), (isPbPb?"PbPb":"PP"))
		      ));

      ws.factory(Form("Exponential::%s(%s, One[1.0])", Form("pdfMASS_%s_%s", object.c_str(), (isPbPb?"PbPb":"PP")),
                      Form("pdfMASSPol_%s_%s", object.c_str(), (isPbPb?"PbPb":"PP"))
                      ));

      ws.factory(Form("RooExtendPdf::%s(%s,%s)", Form("pdfMASSTot_%s_%s", object.c_str(), (isPbPb?"PbPb":"PP")),
                      Form("pdfMASS_%s_%s", object.c_str(), (isPbPb?"PbPb":"PP")),
                      Form("N_%s_%s", object.c_str(), (isPbPb?"PbPb":"PP"))
                      ));

      cout << Form("[INFO] %s Background 5th Order Exponential Chebychev PDF in %s included", object.c_str(), (isPbPb?"PbPb":"PP")) << endl; break; 
   
    case (MassModel::ExpChebychev6): 

      // check that all input parameters are defined 
      if (!( 
            parIni.count(Form("lambda1_%s_%s", object.c_str(), (isPbPb?"PbPb":"PP"))),
            parIni.count(Form("lambda2_%s_%s", object.c_str(), (isPbPb?"PbPb":"PP"))),
            parIni.count(Form("lambda3_%s_%s", object.c_str(), (isPbPb?"PbPb":"PP"))),
            parIni.count(Form("lambda4_%s_%s", object.c_str(), (isPbPb?"PbPb":"PP"))),
            parIni.count(Form("lambda5_%s_%s", object.c_str(), (isPbPb?"PbPb":"PP"))),
            parIni.count(Form("lambda6_%s_%s", object.c_str(), (isPbPb?"PbPb":"PP")))     
             )) { 
	cout << Form("[ERROR] Initial parameters where not found for %s Background Sixth Order Exponential Chebychev in %s", object.c_str(), (isPbPb?"PbPb":"PP")) << endl; return false;
      }

      // create the variables for this model    
      ws.factory( parIni["invMassNorm"].c_str() );    
      ws.factory( parIni[Form("lambda1_%s_%s", object.c_str(), (isPbPb?"PbPb":"PP"))].c_str() );
      ws.factory( parIni[Form("lambda2_%s_%s", object.c_str(), (isPbPb?"PbPb":"PP"))].c_str() );
      ws.factory( parIni[Form("lambda3_%s_%s", object.c_str(), (isPbPb?"PbPb":"PP"))].c_str() );
      ws.factory( parIni[Form("lambda4_%s_%s", object.c_str(), (isPbPb?"PbPb":"PP"))].c_str() );
      ws.factory( parIni[Form("lambda5_%s_%s", object.c_str(), (isPbPb?"PbPb":"PP"))].c_str() );
      ws.factory( parIni[Form("lambda6_%s_%s", object.c_str(), (isPbPb?"PbPb":"PP"))].c_str() );

      // create the PDF
      ws.factory(Form("RooFormulaVar::%s('@6*(32.0*@0*@0*@0*@0*@0*@0 - 48.0*@0*@0*@0*@0 + 18.0*@0*@0 - 1.0) + @5*(16.0*@0*@0*@0*@0*@0 - 20.0*@0*@0*@0 + 5.0*@0) + @4*(8.0*@0*@0*@0*@0 - 8.0*@0*@0 + 1.0) + @3*(4.0*@0*@0*@0 - 3.0*@0) + @2*(2.0*@0*@0 - 1.0) + @1*(@0) + 1.0', {%s, %s, %s, %s, %s, %s, %s})", 
                      Form("pdfMASSPol_%s_%s", object.c_str(), (isPbPb?"PbPb":"PP")), "invMassNorm",
		      Form("lambda1_%s_%s", object.c_str(), (isPbPb?"PbPb":"PP")), 
		      Form("lambda2_%s_%s", object.c_str(), (isPbPb?"PbPb":"PP")), 
		      Form("lambda3_%s_%s", object.c_str(), (isPbPb?"PbPb":"PP")), 
		      Form("lambda4_%s_%s", object.c_str(), (isPbPb?"PbPb":"PP")), 
		      Form("lambda5_%s_%s", object.c_str(), (isPbPb?"PbPb":"PP")), 
		      Form("lambda6_%s_%s", object.c_str(), (isPbPb?"PbPb":"PP"))
		      ));

      ws.factory(Form("Exponential::%s(%s, One[1.0])", Form("pdfMASS_%s_%s", object.c_str(), (isPbPb?"PbPb":"PP")),
                      Form("pdfMASSPol_%s_%s", object.c_str(), (isPbPb?"PbPb":"PP"))
                      ));

      ws.factory(Form("RooExtendPdf::%s(%s,%s)", Form("pdfMASSTot_%s_%s", object.c_str(), (isPbPb?"PbPb":"PP")),
                      Form("pdfMASS_%s_%s", object.c_str(), (isPbPb?"PbPb":"PP")),
                      Form("N_%s_%s", object.c_str(), (isPbPb?"PbPb":"PP"))
                      ));

      cout << Form("[INFO] %s Background 6th Order Exponential Chebychev PDF in %s included", object.c_str(), (isPbPb?"PbPb":"PP")) << endl; break; 

    case (MassModel::Exponential): 

      // check that all input parameters are defined 
      if (!( 
            parIni.count(Form("lambda1_%s_%s", object.c_str(), (isPbPb?"PbPb":"PP"))) 
             )) { 
	cout << Form("[ERROR] Initial parameters where not found for %s Background Exponential in %s", object.c_str(), (isPbPb?"PbPb":"PP")) << endl; return false;
      }

      // create the variables for this model        
      ws.factory( parIni[Form("lambda1_%s_%s", object.c_str(), (isPbPb?"PbPb":"PP"))].c_str() );

      // create the PDF                 
      ws.factory(Form("Exponential::%s(%s, %s)", Form("pdfMASS_%s_%s", object.c_str(), (isPbPb?"PbPb":"PP")), "invMass", 
		      Form("lambda1_%s_%s", object.c_str(), (isPbPb?"PbPb":"PP"))
		      ));

      ws.factory(Form("RooExtendPdf::%s(%s,%s)", Form("pdfMASSTot_%s_%s", object.c_str(), (isPbPb?"PbPb":"PP")),
                      Form("pdfMASS_%s_%s", object.c_str(), (isPbPb?"PbPb":"PP")),
                      Form("N_%s_%s", object.c_str(), (isPbPb?"PbPb":"PP"))
                      ));

      cout << Form("[INFO] %s Background Exponential PDF in %s included", object.c_str(), (isPbPb?"PbPb":"PP")) << endl; break;
   
    default :
      
      cout << "[ERROR] Selected Background Mass Model: " << parIni[Form("Model_%s_%s", object.c_str(), (isPbPb?"PbPb":"PP"))] << " has not been implemented" << endl; return false;
    
    }
  
  return true;
};


bool addSignalMassModel(RooWorkspace& ws, const string& object, const MassModel& model, map<string,string> parIni, const bool& isPbPb)
{
  cout << Form("[INFO] Implementing %s Mass Model", object.c_str()) << endl;
  
  const std::string lb = Form("_%s_%s", object.c_str(), (isPbPb?"PbPb":"PP"));
  std::unique_ptr<RooAbsPdf> pdf;

  // Import the Yield parameter
  if (!ws.var(Form("N_%s_%s", object.c_str(), (isPbPb?"PbPb":"PP")))) { ws.factory(parIni[Form("N_%s_%s", object.c_str(), (isPbPb?"PbPb":"PP"))].c_str()); }

  switch(model) 
    {    
    case (MassModel::SingleGaussian): 
      
      // check that all input parameters are defined
      if (!( 
            parIni.count(Form("m_%s_%s", object.c_str(), (isPbPb?"PbPb":"PP"))) && 
            parIni.count(Form("sigma1_%s_%s", object.c_str(), (isPbPb?"PbPb":"PP"))) 
             )) { 
	cout << Form("[ERROR] Initial parameters where not found for %s Single Gaussian Model in %s", object.c_str(), (isPbPb?"PbPb":"PP")) << endl; return false;
      }

      // create the variables for this model        
      ws.factory( parIni[Form("m_%s_%s", object.c_str(), (isPbPb?"PbPb":"PP"))].c_str() );
      ws.factory( parIni[Form("sigma1_%s_%s", object.c_str(), (isPbPb?"PbPb":"PP"))].c_str() );

      // create the PDF                       
      ws.factory(Form("Gaussian::%s(%s, %s, %s)", Form("pdfMASS_%s_%s", object.c_str(), (isPbPb?"PbPb":"PP")), "invMass", 
		      Form("m_%s_%s", object.c_str(), (isPbPb?"PbPb":"PP")), 
		      Form("sigma1_%s_%s", object.c_str(), (isPbPb?"PbPb":"PP"))
		      ));

      ws.factory(Form("RooExtendPdf::%s(%s,%s)", Form("pdfMASSTot_%s_%s", object.c_str(), (isPbPb?"PbPb":"PP")),
                      Form("pdfMASS_%s_%s", object.c_str(), (isPbPb?"PbPb":"PP")),
                      Form("N_%s_%s", object.c_str(), (isPbPb?"PbPb":"PP"))
                      ));
    
      cout << Form("[INFO] %s Single Gaussian PDF in %s included", object.c_str(), (isPbPb?"PbPb":"PP")) << endl; break;  
      
    case (MassModel::DoubleGaussian): 

      // check that all input parameters are defined
      if (!( 
            parIni.count(Form("m_%s_%s", object.c_str(), (isPbPb?"PbPb":"PP"))) && 
            parIni.count(Form("sigma1_%s_%s", object.c_str(), (isPbPb?"PbPb":"PP"))) && 
            parIni.count(Form("sigma2_%s_%s", object.c_str(), (isPbPb?"PbPb":"PP"))) && 
            parIni.count(Form("f_%s_%s", object.c_str(), (isPbPb?"PbPb":"PP"))) 
             )) { 
	cout << Form("[ERROR] Initial parameters where not found for %s Double Gaussian Model in %s", object.c_str(), (isPbPb?"PbPb":"PP")) << endl; return false; 
      }

      // create the variables for this model              
      ws.factory( parIni[Form("f_%s_%s", object.c_str(), (isPbPb?"PbPb":"PP"))].c_str() );
      ws.factory( parIni[Form("m_%s_%s", object.c_str(), (isPbPb?"PbPb":"PP"))].c_str() ); 
      ws.factory( parIni[Form("sigma1_%s_%s", object.c_str(), (isPbPb?"PbPb":"PP"))].c_str() );
      ws.factory( parIni[Form("sigma2_%s_%s", object.c_str(), (isPbPb?"PbPb":"PP"))].c_str() );

      // create the two PDFs             
      ws.factory(Form("Gaussian::%s(%s, %s, %s)", Form("pdfMASS1_%s_%s", object.c_str(), (isPbPb?"PbPb":"PP")), "invMass", 
                      Form("m_%s_%s", object.c_str(), (isPbPb?"PbPb":"PP")), 
                      Form("sigma1_%s_%s", object.c_str(), (isPbPb?"PbPb":"PP"))
                      ));
      ws.factory(Form("Gaussian::%s(%s, %s, %s)", Form("pdfMASS2_%s_%s", object.c_str(), (isPbPb?"PbPb":"PP")), "invMass", 
                      Form("m_%s_%s", object.c_str(), (isPbPb?"PbPb":"PP")), 
                      Form("sigma2_%s_%s", object.c_str(), (isPbPb?"PbPb":"PP"))
                      ));

      // Sum the PDFs to get the signal PDF
      ws.factory(Form("SUM::%s(%s*%s, %s)", Form("pdfMASS_%s_%s", object.c_str(), (isPbPb?"PbPb":"PP")),
		      Form("f_%s_%s", object.c_str(), (isPbPb?"PbPb":"PP")),
		      Form("pdfMASS1_%s_%s", object.c_str(), (isPbPb?"PbPb":"PP")),
		      Form("pdfMASS2_%s_%s", object.c_str(), (isPbPb?"PbPb":"PP"))
		      ));

      ws.factory(Form("RooExtendPdf::%s(%s,%s)", Form("pdfMASSTot_%s_%s", object.c_str(), (isPbPb?"PbPb":"PP")),
                      Form("pdfMASS_%s_%s", object.c_str(), (isPbPb?"PbPb":"PP")),
                      Form("N_%s_%s", object.c_str(), (isPbPb?"PbPb":"PP"))
                      ));

      cout << Form("[INFO] %s Double Gaussian PDF in %s included", object.c_str(), (isPbPb?"PbPb":"PP")) << endl; break; 

    case (MassModel::SingleCrystalBall):  

      // check that all input parameters are defined
      if (!( 
            parIni.count(Form("m_%s_%s", object.c_str(), (isPbPb?"PbPb":"PP"))) && 
            parIni.count(Form("sigma1_%s_%s", object.c_str(), (isPbPb?"PbPb":"PP"))) && 
            parIni.count(Form("alpha_%s_%s", object.c_str(), (isPbPb?"PbPb":"PP"))) &&
            parIni.count(Form("n_%s_%s", object.c_str(), (isPbPb?"PbPb":"PP")))
             )) {
	cout << Form("[ERROR] Initial parameters where not found for %s Single Crystal Ball Model in %s", object.c_str(), (isPbPb?"PbPb":"PP")) << endl; return false; 
      }

      // create the variables for this model             
      ws.factory( parIni[Form("m_%s_%s", object.c_str(), (isPbPb?"PbPb":"PP"))].c_str() );
      ws.factory( parIni[Form("sigma1_%s_%s", object.c_str(), (isPbPb?"PbPb":"PP"))].c_str() );
      ws.factory( parIni[Form("alpha_%s_%s", object.c_str(), (isPbPb?"PbPb":"PP"))].c_str() );
      ws.factory( parIni[Form("n_%s_%s", object.c_str(), (isPbPb?"PbPb":"PP"))].c_str() );

      // create the PDF              
      ws.factory(Form("CBShape::%s(%s, %s, %s, %s, %s)", Form("pdfMASS_%s_%s", object.c_str(), (isPbPb?"PbPb":"PP")), "invMass", 
		      Form("m_%s_%s", object.c_str(), (isPbPb?"PbPb":"PP")), 
		      Form("sigma1_%s_%s", object.c_str(), (isPbPb?"PbPb":"PP")),
		      Form("alpha_%s_%s", object.c_str(), (isPbPb?"PbPb":"PP")),
		      Form("n_%s_%s", object.c_str(), (isPbPb?"PbPb":"PP"))
		      ));

      ws.factory(Form("RooExtendPdf::%s(%s,%s)", Form("pdfMASSTot_%s_%s", object.c_str(), (isPbPb?"PbPb":"PP")),
                      Form("pdfMASS_%s_%s", object.c_str(), (isPbPb?"PbPb":"PP")),
                      Form("N_%s_%s", object.c_str(), (isPbPb?"PbPb":"PP"))
                      ));

      cout << Form("[INFO] %s Single Crystal Ball PDF in %s included", object.c_str(), (isPbPb?"PbPb":"PP")) << endl; break;
      
    case (MassModel::ExtendedCrystalBall):  

      gROOT->ProcessLine(".L ./Macros/Utilities/RooExtCBShape.cxx+");
      // check that all input parameters are defined
      if (!( 
            parIni.count(Form("m_%s_%s", object.c_str(), (isPbPb?"PbPb":"PP"))) &&
            parIni.count(Form("sigma1_%s_%s", object.c_str(), (isPbPb?"PbPb":"PP"))) &&
            parIni.count(Form("alpha_%s_%s", object.c_str(), (isPbPb?"PbPb":"PP"))) &&
            parIni.count(Form("n_%s_%s", object.c_str(), (isPbPb?"PbPb":"PP"))) &&
            parIni.count(Form("alpha2_%s_%s", object.c_str(), (isPbPb?"PbPb":"PP"))) &&
            parIni.count(Form("n2_%s_%s", object.c_str(), (isPbPb?"PbPb":"PP")))
             )) {
	cout << Form("[ERROR] Initial parameters where not found for %s Extended Crystal Ball Model in %s", object.c_str(), (isPbPb?"PbPb":"PP")) << endl; return false; 
      }

      // create the variables for this model
      ws.factory( parIni[Form("m_%s_%s", object.c_str(), (isPbPb?"PbPb":"PP"))].c_str() );
      ws.factory( parIni[Form("sigma1_%s_%s", object.c_str(), (isPbPb?"PbPb":"PP"))].c_str() );
      ws.factory( parIni[Form("alpha_%s_%s", object.c_str(), (isPbPb?"PbPb":"PP"))].c_str() );
      ws.factory( parIni[Form("n_%s_%s", object.c_str(), (isPbPb?"PbPb":"PP"))].c_str() );
      ws.factory( parIni[Form("alpha2_%s_%s", object.c_str(), (isPbPb?"PbPb":"PP"))].c_str() );
      ws.factory( parIni[Form("n2_%s_%s", object.c_str(), (isPbPb?"PbPb":"PP"))].c_str() );

      // create the PDF
      pdf.reset(new RooExtCBShape(("pdfMASS"+lb).c_str(), ("pdfMASS"+lb).c_str(),
                                  *ws.var("invMass"),
                                  *ws.var(("m"+lb).c_str()),
                                  *ws.var(("sigma1"+lb).c_str()),
                                  *ws.var(("alpha"+lb).c_str()),
                                  *ws.var(("n"+lb).c_str()),
                                  *ws.var(("alpha2"+lb).c_str()),
                                  *ws.var(("n2"+lb).c_str())
                                  ));
      if (pdf) { ws.import(*pdf); }
      ws.factory(Form("RooExtendPdf::%s(%s,%s)", Form("pdfMASSTot_%s_%s", object.c_str(), (isPbPb?"PbPb":"PP")),
                      Form("pdfMASS_%s_%s", object.c_str(), (isPbPb?"PbPb":"PP")),
                      Form("N_%s_%s", object.c_str(), (isPbPb?"PbPb":"PP"))
                      ));

      cout << Form("[INFO] %s Extended Crystal Ball PDF in %s included", object.c_str(), (isPbPb?"PbPb":"PP")) << endl; break;
      
    case (MassModel::DoubleCrystalBall): 
      
      // check that all input parameters are defined
        if (!(
              parIni.count(Form("m_%s_%s", object.c_str(), (isPbPb?"PbPb":"PP"))) &&
              parIni.count(Form("sigma1_%s_%s", object.c_str(), (isPbPb?"PbPb":"PP"))) &&
              parIni.count(Form("sigma2_%s_%s", object.c_str(), (isPbPb?"PbPb":"PP"))) &&
              parIni.count(Form("alpha_%s_%s", object.c_str(), (isPbPb?"PbPb":"PP"))) &&
              parIni.count(Form("alpha2_%s_%s", object.c_str(), (isPbPb?"PbPb":"PP"))) &&
              parIni.count(Form("n_%s_%s", object.c_str(), (isPbPb?"PbPb":"PP"))) &&
              parIni.count(Form("n2_%s_%s", object.c_str(), (isPbPb?"PbPb":"PP"))) &&
              parIni.count(Form("f_%s_%s", object.c_str(), (isPbPb?"PbPb":"PP")))
              )) {
          cout << Form("[ERROR] Initial parameters where not found for %s Double Crystal Ball Model in %s", object.c_str(), (isPbPb?"PbPb":"PP")) << endl; return false;
        }
        
      // create the variables for this model             
      ws.factory( parIni[Form("f_%s_%s", object.c_str(), (isPbPb?"PbPb":"PP"))].c_str() );
      ws.factory( parIni[Form("m_%s_%s", object.c_str(), (isPbPb?"PbPb":"PP"))].c_str() );
      ws.factory( parIni[Form("sigma1_%s_%s", object.c_str(), (isPbPb?"PbPb":"PP"))].c_str() );
      ws.factory( parIni[Form("alpha_%s_%s", object.c_str(), (isPbPb?"PbPb":"PP"))].c_str() );
      ws.factory( parIni[Form("alpha2_%s_%s", object.c_str(), (isPbPb?"PbPb":"PP"))].c_str() );
      ws.factory( parIni[Form("n_%s_%s", object.c_str(), (isPbPb?"PbPb":"PP"))].c_str() );
      ws.factory( parIni[Form("n2_%s_%s", object.c_str(), (isPbPb?"PbPb":"PP"))].c_str() );
      ws.factory( parIni[Form("sigma2_%s_%s", object.c_str(), (isPbPb?"PbPb":"PP"))].c_str() );

      // create the two PDFs
      ws.factory(Form("CBShape::%s(%s, %s, %s, %s, %s)", Form("pdfMASS1_%s_%s", object.c_str(), (isPbPb?"PbPb":"PP")), "invMass", 
                      Form("m_%s_%s", object.c_str(), (isPbPb?"PbPb":"PP")), 
                      Form("sigma1_%s_%s", object.c_str(), (isPbPb?"PbPb":"PP")),
                      Form("alpha_%s_%s", object.c_str(), (isPbPb?"PbPb":"PP")),
                      Form("n_%s_%s", object.c_str(), (isPbPb?"PbPb":"PP"))
                      ));
      ws.factory(Form("CBShape::%s(%s, %s, %s, %s, %s)", Form("pdfMASS2_%s_%s", object.c_str(), (isPbPb?"PbPb":"PP")), "invMass", 
                      Form("m_%s_%s", object.c_str(), (isPbPb?"PbPb":"PP")), 
                      Form("sigma2_%s_%s", object.c_str(), (isPbPb?"PbPb":"PP")),
                      Form("alpha2_%s_%s", object.c_str(), (isPbPb?"PbPb":"PP")),
                      Form("n2_%s_%s", object.c_str(), (isPbPb?"PbPb":"PP"))
                      ));

      // Sum the PDFs to get the signal PDF
      ws.factory(Form("SUM::%s(%s*%s, %s)", Form("pdfMASS_%s_%s", object.c_str(), (isPbPb?"PbPb":"PP")),
		      Form("f_%s_%s", object.c_str(), (isPbPb?"PbPb":"PP")),
		      Form("pdfMASS1_%s_%s", object.c_str(), (isPbPb?"PbPb":"PP")),
		      Form("pdfMASS2_%s_%s", object.c_str(), (isPbPb?"PbPb":"PP"))
		      ));

      ws.factory(Form("RooExtendPdf::%s(%s,%s)", Form("pdfMASSTot_%s_%s", object.c_str(), (isPbPb?"PbPb":"PP")),
                      Form("pdfMASS_%s_%s", object.c_str(), (isPbPb?"PbPb":"PP")),
                      Form("N_%s_%s", object.c_str(), (isPbPb?"PbPb":"PP"))
                      ));

      cout << Form("[INFO] %s Double Crystal Ball PDF in %s included", object.c_str(), (isPbPb?"PbPb":"PP")) << endl; break;
      
    case (MassModel::GaussianAndCrystalBall):

      // check that all input parameters are defined
      if (!( 
            parIni.count(Form("m_%s_%s", object.c_str(), (isPbPb?"PbPb":"PP"))) && 
            parIni.count(Form("sigma1_%s_%s", object.c_str(), (isPbPb?"PbPb":"PP"))) && 
            parIni.count(Form("sigma2_%s_%s", object.c_str(), (isPbPb?"PbPb":"PP"))) && 
            parIni.count(Form("alpha_%s_%s", object.c_str(), (isPbPb?"PbPb":"PP"))) &&
            parIni.count(Form("n_%s_%s", object.c_str(), (isPbPb?"PbPb":"PP"))) &&
            parIni.count(Form("f_%s_%s", object.c_str(), (isPbPb?"PbPb":"PP")))  
             )) { 
	cout << Form("[ERROR] Initial parameters where not found for %s Gaussian and Crystal Ball Model in %s", object.c_str(), (isPbPb?"PbPb":"PP")) << endl; return false;
      } 

      // create the variables for this model             
      ws.factory( parIni[Form("f_%s_%s", object.c_str(), (isPbPb?"PbPb":"PP"))].c_str() );
      ws.factory( parIni[Form("m_%s_%s", object.c_str(), (isPbPb?"PbPb":"PP"))].c_str() );
      ws.factory( parIni[Form("sigma1_%s_%s", object.c_str(), (isPbPb?"PbPb":"PP"))].c_str() );
      ws.factory( parIni[Form("sigma2_%s_%s", object.c_str(), (isPbPb?"PbPb":"PP"))].c_str() );
      ws.factory( parIni[Form("alpha_%s_%s", object.c_str(), (isPbPb?"PbPb":"PP"))].c_str() );
      ws.factory( parIni[Form("n_%s_%s", object.c_str(), (isPbPb?"PbPb":"PP"))].c_str() );
      
      // create the two PDFs
      ws.factory(Form("CBShape::%s(%s, %s, %s, %s, %s)", Form("pdfMASS1_%s_%s", object.c_str(), (isPbPb?"PbPb":"PP")), "invMass",
                        Form("m_%s_%s", object.c_str(), (isPbPb?"PbPb":"PP")),
                        Form("sigma1_%s_%s", object.c_str(), (isPbPb?"PbPb":"PP")),
                        Form("alpha_%s_%s", object.c_str(), (isPbPb?"PbPb":"PP")),
                        Form("n_%s_%s", object.c_str(), (isPbPb?"PbPb":"PP"))
                        ));
        
      ws.factory(Form("Gaussian::%s(%s, %s, %s)", Form("pdfMASS2_%s_%s", object.c_str(), (isPbPb?"PbPb":"PP")), "invMass",
                      Form("m_%s_%s", object.c_str(), (isPbPb?"PbPb":"PP")), 
                      Form("sigma2_%s_%s", object.c_str(), (isPbPb?"PbPb":"PP"))
                      ));
 
      // Sum the PDFs to get the signal PDF 
      ws.factory(Form("SUM::%s(%s*%s, %s)", Form("pdfMASS_%s_%s", object.c_str(), (isPbPb?"PbPb":"PP")),
		      Form("f_%s_%s", object.c_str(), (isPbPb?"PbPb":"PP")),
		      Form("pdfMASS1_%s_%s", object.c_str(), (isPbPb?"PbPb":"PP")),
		      Form("pdfMASS2_%s_%s", object.c_str(), (isPbPb?"PbPb":"PP"))
		      ));

      ws.factory(Form("RooExtendPdf::%s(%s,%s)", Form("pdfMASSTot_%s_%s", object.c_str(), (isPbPb?"PbPb":"PP")),
                      Form("pdfMASS_%s_%s", object.c_str(), (isPbPb?"PbPb":"PP")),
                      Form("N_%s_%s", object.c_str(), (isPbPb?"PbPb":"PP"))
                      ));

      cout << Form("[INFO] %s Gaussian and Crystal Ball PDF in %s included", object.c_str(), (isPbPb?"PbPb":"PP")) << endl; break;
	
    default :

      cout << "[ERROR] Selected Signal Mass Model: " << parIni[Form("Model_%s_%s", object.c_str(), (isPbPb?"PbPb":"PP"))] << " has not been implemented" << endl; return false;

    }
  
  return true;
};

void fixMassParPsi2StoJpsi(map<string, string>& parIni, const bool& isPbPb)
{
  cout << "[INFO] Constraining Psi(2S) parameters to Jpsi using PDF Mass Ratio" << endl;
  const double MassRatio = (Mass.Psi2S/Mass.JPsi);
  parIni[Form("m_Psi2S_%s", (isPbPb?"PbPb":"PP"))]      = Form("RooFormulaVar::%s('@0*@1',{MassRatio[%.6f],%s})", Form("m_Psi2S_%s", (isPbPb?"PbPb":"PP")), MassRatio, Form("m_Jpsi_%s", (isPbPb?"PbPb":"PP") ));
  parIni[Form("sigma1_Psi2S_%s", (isPbPb?"PbPb":"PP"))] = Form("RooFormulaVar::%s('@0*@1',{MassRatio,%s})", Form("sigma1_Psi2S_%s", (isPbPb?"PbPb":"PP")), Form("sigma1_Jpsi_%s", (isPbPb?"PbPb":"PP") ));
  parIni[Form("sigma2_Psi2S_%s", (isPbPb?"PbPb":"PP"))] = Form("RooFormulaVar::%s('@0*@1',{MassRatio,%s})", Form("sigma2_Psi2S_%s", (isPbPb?"PbPb":"PP")), Form("sigma2_Jpsi_%s", (isPbPb?"PbPb":"PP") ));
  parIni[Form("alpha_Psi2S_%s", (isPbPb?"PbPb":"PP"))]  = Form("RooFormulaVar::%s('@0',{%s})", Form("alpha_Psi2S_%s", (isPbPb?"PbPb":"PP")), Form("alpha_Jpsi_%s", (isPbPb?"PbPb":"PP")));
  parIni[Form("alpha2_Psi2S_%s", (isPbPb?"PbPb":"PP"))] = Form("RooFormulaVar::%s('@0',{%s})", Form("alpha2_Psi2S_%s", (isPbPb?"PbPb":"PP")), Form("alpha2_Jpsi_%s", (isPbPb?"PbPb":"PP")));
  parIni[Form("n_Psi2S_%s", (isPbPb?"PbPb":"PP"))]      = Form("RooFormulaVar::%s('@0',{%s})", Form("n_Psi2S_%s", (isPbPb?"PbPb":"PP")), Form("n_Jpsi_%s", (isPbPb?"PbPb":"PP")));
  parIni[Form("n2_Psi2S_%s", (isPbPb?"PbPb":"PP"))]     = Form("RooFormulaVar::%s('@0',{%s})", Form("n2_Psi2S_%s", (isPbPb?"PbPb":"PP")), Form("n2_Jpsi_%s", (isPbPb?"PbPb":"PP")));
  parIni[Form("f_Psi2S_%s", (isPbPb?"PbPb":"PP"))]      = Form("RooFormulaVar::%s('@0',{%s})", Form("f_Psi2S_%s", (isPbPb?"PbPb":"PP")), Form("f_Jpsi_%s", (isPbPb?"PbPb":"PP")));
};

void setMassDefaultParameters(map<string, string>& parIni, const bool& isPbPb, const double& numEntries)
{

  cout << "[INFO] Setting user undefined initial parameters to their default values" << endl;

  // DEFAULT SINGLE AND DOUBLE RATIO PARAMETERS
  if (parIni.count("RFrac2Svs1S_PbPbvsPP")==0 || parIni["RFrac2Svs1S_PbPbvsPP"]=="") { 
    parIni["RFrac2Svs1S_PbPbvsPP"] = Form("%s[%.4f,%.4f,%.4f]", "RFrac2Svs1S_PbPbvsPP", 0.26, -3.0, 3.0);
  }
  if (parIni.count(Form("RFrac2Svs1S_%s", (isPbPb?"PbPb":"PP")))==0 || parIni[Form("RFrac2Svs1S_%s", (isPbPb?"PbPb":"PP"))]=="") {
    parIni[Form("RFrac2Svs1S_%s", (isPbPb?"PbPb":"PP"))] = Form("%s[%.4f,%.4f,%.4f]", Form("RFrac2Svs1S_%s", (isPbPb?"PbPb":"PP")), 0.26, -2.0, 2.0);
  }

  // DEFAULT RANGE OF NUMBER OF EVENTS
  if (parIni.count(Form("N_Jpsi_%s", (isPbPb?"PbPb":"PP")))==0 || parIni[Form("N_Jpsi_%s", (isPbPb?"PbPb":"PP"))]=="") { 
    parIni[Form("N_Jpsi_%s", (isPbPb?"PbPb":"PP"))]  = Form("%s[%.10f,%.10f,%.10f]", Form("N_Jpsi_%s", (isPbPb?"PbPb":"PP")), numEntries, -2.0*numEntries, 2.0*numEntries);
  }
  if (parIni.count(Form("N_Psi2S_%s", (isPbPb?"PbPb":"PP")))==0 || parIni[Form("N_Psi2S_%s", (isPbPb?"PbPb":"PP"))]=="") { 
    parIni[Form("N_Psi2S_%s", (isPbPb?"PbPb":"PP"))]  = Form("%s[%.10f,%.10f,%.10f]", Form("N_Psi2S_%s", (isPbPb?"PbPb":"PP")), numEntries, -2.0*numEntries, 2.0*numEntries);
  }
  if (parIni.count(Form("N_Bkg_%s", (isPbPb?"PbPb":"PP")))==0 || parIni[Form("N_Bkg_%s", (isPbPb?"PbPb":"PP"))]=="") { 
    parIni[Form("N_Bkg_%s", (isPbPb?"PbPb":"PP"))]  = Form("%s[%.10f,%.10f,%.10f]", Form("N_Bkg_%s", (isPbPb?"PbPb":"PP")), numEntries, -2.0*numEntries, 2.0*numEntries);
  }

  // DEFAULT SIGNAL MASS MODEL PARAMETERS 
  if (parIni.count(Form("m_Jpsi_%s", (isPbPb?"PbPb":"PP")))==0 || parIni[Form("m_Jpsi_%s", (isPbPb?"PbPb":"PP"))]=="") {
    parIni[Form("m_Jpsi_%s", (isPbPb?"PbPb":"PP"))] = Form("%s[%.6f,%.6f,%.6f]", Form("m_Jpsi_%s", (isPbPb?"PbPb":"PP")), Mass.JPsi, Mass.JPsi-0.1, Mass.JPsi+0.1);
  }
  if (parIni.count(Form("m_Psi2S_%s", (isPbPb?"PbPb":"PP")))==0 || parIni[Form("m_Psi2S_%s", (isPbPb?"PbPb":"PP"))]=="") {
    parIni[Form("m_Psi2S_%s", (isPbPb?"PbPb":"PP"))] = Form("%s[%.6f,%.6f,%.6f]", Form("m_Psi2S_%s", (isPbPb?"PbPb":"PP")), Mass.Psi2S, Mass.Psi2S-0.1, Mass.Psi2S+0.1);
  }
  if (parIni.count(Form("sigma1_Jpsi_%s", (isPbPb?"PbPb":"PP")))==0 || parIni[Form("sigma1_Jpsi_%s", (isPbPb?"PbPb":"PP"))]=="") {
    parIni[Form("sigma1_Jpsi_%s", (isPbPb?"PbPb":"PP"))] = Form("%s[%.4f,%.4f,%.4f]", Form("sigma1_Jpsi_%s", (isPbPb?"PbPb":"PP")), 0.02, 0.005, 0.07);
  }
  if (parIni.count(Form("rSigma21_Jpsi_%s", (isPbPb?"PbPb":"PP")))==0) {
    if (parIni.count(Form("sigma2_Jpsi_%s", (isPbPb?"PbPb":"PP")))==0 || parIni[Form("sigma2_Jpsi_%s", (isPbPb?"PbPb":"PP"))]=="") {
      parIni[Form("sigma2_Jpsi_%s", (isPbPb?"PbPb":"PP"))] = Form("%s[%.4f,%.4f,%.4f]", Form("sigma2_Jpsi_%s", (isPbPb?"PbPb":"PP")), 0.04, 0.01, 0.10);
    }
  } else {
    if (parIni[Form("rSigma21_Jpsi_%s", (isPbPb?"PbPb":"PP"))]=="") {
      parIni[Form("rSigma21_Jpsi_%s", (isPbPb?"PbPb":"PP"))] = Form("%s[%.4f,%.4f,%.4f]", Form("rSigma21_Jpsi_%s", (isPbPb?"PbPb":"PP")), 2.0, 1.0, 4.0);
    }
    parIni[Form("sigma2_Jpsi_%s", (isPbPb?"PbPb":"PP"))] = Form("RooFormulaVar::%s('@0*@1',{%s,%s})", Form("sigma2_Jpsi_%s", (isPbPb?"PbPb":"PP")),
                                                                parIni[Form("rSigma21_Jpsi_%s", (isPbPb?"PbPb":"PP"))].c_str(), Form("sigma1_Jpsi_%s", (isPbPb?"PbPb":"PP") ));
  }      
  if (parIni.count(Form("sigma1_Psi2S_%s", (isPbPb?"PbPb":"PP")))==0 || parIni[Form("sigma1_Psi2S_%s", (isPbPb?"PbPb":"PP"))]=="") {
    parIni[Form("sigma1_Psi2S_%s", (isPbPb?"PbPb":"PP"))] = Form("%s[%.4f,%.4f,%.4f]", Form("sigma1_Psi2S_%s", (isPbPb?"PbPb":"PP")), 0.02, 0.005, 0.07);
  }
  if (parIni.count(Form("rSigma21_Psi2S_%s", (isPbPb?"PbPb":"PP")))==0) {
    if (parIni.count(Form("sigma2_Psi2S_%s", (isPbPb?"PbPb":"PP")))==0 || parIni[Form("sigma2_Psi2S_%s", (isPbPb?"PbPb":"PP"))]=="") {
      parIni[Form("sigma2_Psi2S_%s", (isPbPb?"PbPb":"PP"))] = Form("%s[%.4f,%.4f,%.4f]", Form("sigma2_Psi2S_%s", (isPbPb?"PbPb":"PP")), 0.04, 0.01, 0.10);
    }
  }
  else {
    if (parIni[Form("rSigma21_Psi2S_%s", (isPbPb?"PbPb":"PP"))]=="") {
      parIni[Form("rSigma21_Psi2S_%s", (isPbPb?"PbPb":"PP"))] = Form("%s[%.4f,%.4f,%.4f]", Form("rSigma21_Psi2S_%s", (isPbPb?"PbPb":"PP")), 2.0, 1.0, 4.0);
    }
    parIni[Form("sigma2_Psi2S_%s", (isPbPb?"PbPb":"PP"))] = Form("RooFormulaVar::%s('@0*@1',{%s,%s})", Form("sigma2_Psi2S_%s", (isPbPb?"PbPb":"PP")), 
                                                                 parIni[Form("rSigma21_Psi2S_%s", (isPbPb?"PbPb":"PP"))].c_str(), Form("sigma1_Psi2S_%s", (isPbPb?"PbPb":"PP") ));
  }
  if (parIni.count(Form("alpha_Jpsi_%s", (isPbPb?"PbPb":"PP")))==0 || parIni[Form("alpha_Jpsi_%s", (isPbPb?"PbPb":"PP"))]=="") {
    parIni[Form("alpha_Jpsi_%s", (isPbPb?"PbPb":"PP"))] = Form("%s[%.4f,%.4f,%.4f]", Form("alpha_Jpsi_%s", (isPbPb?"PbPb":"PP")), 2.0, 0.5, 30.0);
  }
  if (parIni.count(Form("alpha2_Jpsi_%s", (isPbPb?"PbPb":"PP")))==0) {
    parIni[Form("alpha2_Jpsi_%s", (isPbPb?"PbPb":"PP"))] = Form("RooFormulaVar::%s('@0',{%s})", Form("alpha2_Jpsi_%s", (isPbPb?"PbPb":"PP")), Form("alpha_Jpsi_%s", (isPbPb?"PbPb":"PP")));
  }
  else if (parIni[Form("alpha2_Jpsi_%s", (isPbPb?"PbPb":"PP"))]=="")
  {
    parIni[Form("alpha2_Jpsi_%s", (isPbPb?"PbPb":"PP"))] = Form("%s[%.4f,%.4f,%.4f]", Form("alpha2_Jpsi_%s", (isPbPb?"PbPb":"PP")), 2.0, 0.5, 30.0);
  }
  if (parIni.count(Form("alpha_Psi2S_%s", (isPbPb?"PbPb":"PP")))==0 || parIni[Form("alpha_Psi2S_%s", (isPbPb?"PbPb":"PP"))]=="") {
    parIni[Form("alpha_Psi2S_%s", (isPbPb?"PbPb":"PP"))] = Form("%s[%.4f,%.4f,%.4f]", Form("alpha_Psi2S_%s", (isPbPb?"PbPb":"PP")), 2.0, 0.5, 30.0);
  }
  if (parIni.count(Form("alpha2_Psi2S_%s", (isPbPb?"PbPb":"PP")))==0) {
    parIni[Form("alpha2_Psi2S_%s", (isPbPb?"PbPb":"PP"))] = Form("RooFormulaVar::%s('@0',{%s})", Form("alpha2_Psi2S_%s", (isPbPb?"PbPb":"PP")), Form("alpha_Psi2S_%s", (isPbPb?"PbPb":"PP")));
  }
  else if (parIni[Form("alpha2_Psi2S_%s", (isPbPb?"PbPb":"PP"))]=="")
  {
    parIni[Form("alpha2_Psi2S_%s", (isPbPb?"PbPb":"PP"))] = Form("%s[%.4f,%.4f,%.4f]", Form("alpha2_Psi2S_%s", (isPbPb?"PbPb":"PP")), 2.0, 0.5, 30.0);
  }
  if (parIni.count(Form("n_Jpsi_%s", (isPbPb?"PbPb":"PP")))==0 || parIni[Form("n_Jpsi_%s", (isPbPb?"PbPb":"PP"))]=="") {
    parIni[Form("n_Jpsi_%s", (isPbPb?"PbPb":"PP"))] = Form("%s[%.4f,%.4f,%.4f]", Form("n_Jpsi_%s", (isPbPb?"PbPb":"PP")), 1.8, 0.5, 10.0);
  }
  if (parIni.count(Form("n2_Jpsi_%s", (isPbPb?"PbPb":"PP")))==0) {
    parIni[Form("n2_Jpsi_%s", (isPbPb?"PbPb":"PP"))] = Form("RooFormulaVar::%s('@0',{%s})", Form("n2_Jpsi_%s", (isPbPb?"PbPb":"PP")), Form("n_Jpsi_%s", (isPbPb?"PbPb":"PP")));
  }
  else if (parIni[Form("n2_Jpsi_%s", (isPbPb?"PbPb":"PP"))]=="")
  {
    parIni[Form("n2_Jpsi_%s", (isPbPb?"PbPb":"PP"))] = Form("%s[%.4f,%.4f,%.4f]", Form("n2_Jpsi_%s", (isPbPb?"PbPb":"PP")), 12.0, 0.5, 100.0);
  }
  if (parIni.count(Form("n_Psi2S_%s", (isPbPb?"PbPb":"PP")))==0 || parIni[Form("n_Psi2S_%s", (isPbPb?"PbPb":"PP"))]=="") {
    parIni[Form("n_Psi2S_%s", (isPbPb?"PbPb":"PP"))] = Form("%s[%.4f,%.4f,%.4f]", Form("n_Psi2S_%s", (isPbPb?"PbPb":"PP")), 1.8, 0.5, 10.0);
  }
  if (parIni.count(Form("n2_Psi2S_%s", (isPbPb?"PbPb":"PP")))==0) {
    parIni[Form("n2_Psi2S_%s", (isPbPb?"PbPb":"PP"))] = Form("RooFormulaVar::%s('@0',{%s})", Form("n2_Psi2S_%s", (isPbPb?"PbPb":"PP")), Form("n_Psi2S_%s", (isPbPb?"PbPb":"PP")));
  }
  else if (parIni[Form("n2_Psi2S_%s", (isPbPb?"PbPb":"PP"))]=="")
  {
        parIni[Form("n2_Psi2S_%s", (isPbPb?"PbPb":"PP"))] = Form("%s[%.4f,%.4f,%.4f]", Form("n2_Psi2S_%s", (isPbPb?"PbPb":"PP")), 1.8, 0.5, 10.0);
  }
  if (parIni.count(Form("f_Jpsi_%s", (isPbPb?"PbPb":"PP")))==0 || parIni[Form("f_Jpsi_%s", (isPbPb?"PbPb":"PP"))]=="") {
    parIni[Form("f_Jpsi_%s", (isPbPb?"PbPb":"PP"))] = Form("%s[%.4f,%.4f,%.4f]", Form("f_Jpsi_%s", (isPbPb?"PbPb":"PP")), 0.5, 0.0, 1.0);
  }
  if (parIni.count(Form("f_Psi2S_%s", (isPbPb?"PbPb":"PP")))==0 || parIni[Form("f_Psi2S_%s", (isPbPb?"PbPb":"PP"))]=="") {
    parIni[Form("f_Psi2S_%s", (isPbPb?"PbPb":"PP"))] = Form("%s[%.4f,%.4f,%.4f]", Form("f_Psi2S_%s", (isPbPb?"PbPb":"PP")), 0.5, 0.0, 1.0);
  }

  // DEFAULT BACKGROUND MASS MODEL PARAMETERS
  if (parIni[Form("Model_Bkg_%s",(isPbPb?"PbPb":"PP"))].find("ExpChebychev")!=std::string::npos) {
    if (parIni.count(Form("lambda1_Bkg_%s", (isPbPb?"PbPb":"PP")))==0 || parIni[Form("lambda1_Bkg_%s", (isPbPb?"PbPb":"PP"))]=="") { 
      parIni[Form("lambda1_Bkg_%s", (isPbPb?"PbPb":"PP"))] = Form("%s[%.4f,%.4f,%.4f]", Form("lambda1_Bkg_%s", (isPbPb?"PbPb":"PP")), 0.0, -10.0, 10.0);
    }
    if (parIni.count(Form("lambda2_Bkg_%s", (isPbPb?"PbPb":"PP")))==0 || parIni[Form("lambda2_Bkg_%s", (isPbPb?"PbPb":"PP"))]=="") { 
      parIni[Form("lambda2_Bkg_%s", (isPbPb?"PbPb":"PP"))] = Form("%s[%.4f,%.4f,%.4f]", Form("lambda2_Bkg_%s", (isPbPb?"PbPb":"PP")), 0.0, -10.0, 10.0);
    }
    if (parIni.count(Form("lambda3_Bkg_%s", (isPbPb?"PbPb":"PP")))==0 || parIni[Form("lambda3_Bkg_%s", (isPbPb?"PbPb":"PP"))]=="") { 
      parIni[Form("lambda3_Bkg_%s", (isPbPb?"PbPb":"PP"))] = Form("%s[%.4f,%.4f,%.4f]", Form("lambda3_Bkg_%s", (isPbPb?"PbPb":"PP")), 0.0, -10.0, 10.0);
    }
    if (parIni.count(Form("lambda4_Bkg_%s", (isPbPb?"PbPb":"PP")))==0 || parIni[Form("lambda4_Bkg_%s", (isPbPb?"PbPb":"PP"))]=="") { 
      parIni[Form("lambda4_Bkg_%s", (isPbPb?"PbPb":"PP"))] = Form("%s[%.4f,%.4f,%.4f]", Form("lambda4_Bkg_%s", (isPbPb?"PbPb":"PP")), 0.0, -10.0, 10.0);
    }
    if (parIni.count(Form("lambda5_Bkg_%s", (isPbPb?"PbPb":"PP")))==0 || parIni[Form("lambda5_Bkg_%s", (isPbPb?"PbPb":"PP"))]=="") { 
      parIni[Form("lambda5_Bkg_%s", (isPbPb?"PbPb":"PP"))] = Form("%s[%.4f,%.4f,%.4f]", Form("lambda5_Bkg_%s", (isPbPb?"PbPb":"PP")), 0.0, -10.0, 10.0);
    }
    if (parIni.count(Form("lambda6_Bkg_%s", (isPbPb?"PbPb":"PP")))==0 || parIni[Form("lambda6_Bkg_%s", (isPbPb?"PbPb":"PP"))]=="") { 
      parIni[Form("lambda6_Bkg_%s", (isPbPb?"PbPb":"PP"))] = Form("%s[%.4f,%.4f,%.4f]", Form("lambda6_Bkg_%s", (isPbPb?"PbPb":"PP")), 0.0, -10.0, 10.0);
    }
  }
  else if (parIni[Form("Model_Bkg_%s",(isPbPb?"PbPb":"PP"))].find("Chebychev")!=std::string::npos) {
    if (parIni.count(Form("lambda1_Bkg_%s", (isPbPb?"PbPb":"PP")))==0 || parIni[Form("lambda1_Bkg_%s", (isPbPb?"PbPb":"PP"))]=="") { 
      parIni[Form("lambda1_Bkg_%s", (isPbPb?"PbPb":"PP"))] = Form("%s[%.4f,%.4f,%.4f]", Form("lambda1_Bkg_%s", (isPbPb?"PbPb":"PP")), 0.0, -2.0, 2.0);
    }
    if (parIni.count(Form("lambda2_Bkg_%s", (isPbPb?"PbPb":"PP")))==0 || parIni[Form("lambda2_Bkg_%s", (isPbPb?"PbPb":"PP"))]=="") { 
      parIni[Form("lambda2_Bkg_%s", (isPbPb?"PbPb":"PP"))] = Form("%s[%.4f,%.4f,%.4f]", Form("lambda2_Bkg_%s", (isPbPb?"PbPb":"PP")), 0.0, -2.0, 2.0);
    }
    if (parIni.count(Form("lambda3_Bkg_%s", (isPbPb?"PbPb":"PP")))==0 || parIni[Form("lambda3_Bkg_%s", (isPbPb?"PbPb":"PP"))]=="") { 
      parIni[Form("lambda3_Bkg_%s", (isPbPb?"PbPb":"PP"))] = Form("%s[%.4f,%.4f,%.4f]", Form("lambda3_Bkg_%s", (isPbPb?"PbPb":"PP")), 0.0, -2.0, 2.0);
    }
    if (parIni.count(Form("lambda4_Bkg_%s", (isPbPb?"PbPb":"PP")))==0 || parIni[Form("lambda4_Bkg_%s", (isPbPb?"PbPb":"PP"))]=="") { 
      parIni[Form("lambda4_Bkg_%s", (isPbPb?"PbPb":"PP"))] = Form("%s[%.4f,%.4f,%.4f]", Form("lambda4_Bkg_%s", (isPbPb?"PbPb":"PP")), 0.0, -2.0, 2.0);
    }
    if (parIni.count(Form("lambda5_Bkg_%s", (isPbPb?"PbPb":"PP")))==0 || parIni[Form("lambda5_Bkg_%s", (isPbPb?"PbPb":"PP"))]=="") { 
      parIni[Form("lambda5_Bkg_%s", (isPbPb?"PbPb":"PP"))] = Form("%s[%.4f,%.4f,%.4f]", Form("lambda5_Bkg_%s", (isPbPb?"PbPb":"PP")), 0.0, -2.0, 2.0);
    }
    if (parIni.count(Form("lambda6_Bkg_%s", (isPbPb?"PbPb":"PP")))==0 || parIni[Form("lambda6_Bkg_%s", (isPbPb?"PbPb":"PP"))]=="") { 
      parIni[Form("lambda6_Bkg_%s", (isPbPb?"PbPb":"PP"))] = Form("%s[%.4f,%.4f,%.4f]", Form("lambda6_Bkg_%s", (isPbPb?"PbPb":"PP")), 0.0, -2.0, 2.0);
    }
  } 
  else if (parIni[Form("Model_Bkg_%s",(isPbPb?"PbPb":"PP"))].find("Exponential")!=std::string::npos) {
    if (parIni.count(Form("lambda1_Bkg_%s", (isPbPb?"PbPb":"PP")))==0 || parIni[Form("lambda1_Bkg_%s", (isPbPb?"PbPb":"PP"))]=="") { 
      parIni[Form("lambda1_Bkg_%s", (isPbPb?"PbPb":"PP"))] = Form("%s[%.4f,%.4f,%.4f]", Form("lambda1_Bkg_%s", (isPbPb?"PbPb":"PP")), 0.0, -100.0, 100.0);
    }
  }
 
};


#endif // #ifndef buildCharmoniaMassModel_C
